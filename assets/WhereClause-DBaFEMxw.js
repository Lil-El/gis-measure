import{d9 as _o,h8 as Lo,aV as St}from"./index-DXZ_271k.js";import{i as Rt}from"./executionError-N6aCOFps.js";function Mo(l,s){const o=Dt[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Ro(l,s){const o=Dt[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}const Dt={min:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.min.apply(Math,l[0])},max:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.max.apply(Math,l[0])},avg:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Ot(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Do(l[0])},stddev:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sqrt(Et(l[0]))},count:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Et(l[0])}};function Ot(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s/l.length}function Do(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s}function Et(l){const s=Ot(l),o=l.length;let f=0;for(const i of l)f+=(i-s)**2;return o>1?f/(o-1):0}var C;(function(l){l.InvalidFunctionParameters="InvalidFunctionParameters",l.UnsupportedSqlFunction="UnsupportedSqlFunction",l.UnsupportedOperator="UnsupportedOperator",l.UnsupportedSyntax="UnsupportedSyntax",l.UnsupportedIsRhs="UnsupportedIsRhs",l.UnsupportedIsLhs="UnsupportedIsLhs",l.InvalidDataType="InvalidDataType",l.CannotCastValue="CannotCastValue",l.MissingStatisticParameters="MissingStatisticParameters"})(C||(C={}));const Oo={[C.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[C.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[C.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[C.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[C.UnsupportedOperator]:"Unsupported operator - {operator}",[C.UnsupportedSyntax]:"Unsupported syntax - {node}",[C.UnsupportedSqlFunction]:"Sql function not found = {function}",[C.InvalidDataType]:"Invalid sql data type",[C.CannotCastValue]:"Cannot cast value to the required data type"};let j=class $t extends Error{constructor(s,o){super(Rt(Oo[s],o)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,$t)}};var M;(function(l){l.NeverReach="NeverReach",l.NotImplemented="NotImplemented",l.Cancelled="Cancelled",l.InvalidStatResponse="InvalidStatResponse",l.InvalidRequest="InvalidRequest",l.RequestFailed="RequestFailed",l.MissingFeatures="MissingFeatures",l.AggregationFieldNotFound="AggregationFieldNotFound",l.DataElementsNotFound="DataElementsNotFound"})(M||(M={}));const $o={[M.Cancelled]:"Cancelled",[M.InvalidStatResponse]:"Invalid statistics response from service",[M.InvalidRequest]:"Invalid request",[M.RequestFailed]:"Request failed - {reason}",[M.MissingFeatures]:"Missing features",[M.AggregationFieldNotFound]:"Aggregation field not found",[M.DataElementsNotFound]:"Data elements not found on service",[M.NeverReach]:"Encountered unreachable logic",[M.NotImplemented]:"Not implemented"};let Xo=class Jt extends Error{constructor(s,o){super(Rt($o[s],o)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,Jt)}},k=class D{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(s){if(s.precision!==null||s.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static _parseSecondsComponent(s,o){if(o.includes(".")){const f=o.split(".");s.second=parseFloat(f[0]),s.millis=parseInt(f[1],10)}else s.second=parseFloat(o)}static createFromMilliseconds(s){const o=new D;return o.second=s/1e3,o}static createFromValueAndQualifer(s,o,f){let i=null;const d=new D;if(d.op=f==="-"?"-":"+",o.type==="interval-period"){D._fixDefaults(o);const m=new RegExp("^[0-9]{1,}$");if(o.period==="year"||o.period==="month")throw new Error("Year-Month Intervals not supported");if(o.period==="second"){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(s))throw new Error("Illegal Interval");D._parseSecondsComponent(d,s)}else{if(!m.test(s))throw new Error("Illegal Interval");d[o.period]=parseFloat(s)}}else{if(D._fixDefaults(o.start),D._fixDefaults(o.end),o.start.period==="year"||o.start.period==="month")throw new Error("Year-Month Intervals not supported");if(o.end.period==="year"||o.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(o.start.period){case"day":switch(o.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d[o.start.period]=parseFloat(s.split(" ")[0]),d[o.end.period]=parseFloat(s.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),D._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(o.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d.hour=parseFloat(s.split(":")[0]),d.minute=parseFloat(s.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),D._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if(o.end.period!=="second")throw new Error("Invalid Interval.");if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.minute=parseFloat(m[0]),D._parseSecondsComponent(d,m[1])}break;default:throw new Error("Invalid Interval.")}}return d}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}};function _e(l,s){const o=Ut[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Jo(l,s){const o=Ut[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}function Uo(l){return typeof l=="string"||l instanceof String}function ko(l){return l instanceof Date}function Ct(l){const s=new Date(l.getTime());return s.setHours(0,0,0,0),s}function Ft(l,s){if(ko(l))return s?Ct(l):l;if(Uo(l)){const o=Lo.fromSQL(l);if(o.isValid)return s?Ct(o.toJSDate()):o.toJSDate()}throw new j(C.CannotCastValue)}const Ut={extract:{minParams:2,maxParams:2,evaluate:([l,s])=>{if(s==null)return null;if(s instanceof Date)switch(l.toUpperCase()){case"SECOND":return s.getSeconds();case"MINUTE":return s.getMinutes();case"HOUR":return s.getHours();case"DAY":return s.getDate();case"MONTH":return s.getMonth()+1;case"YEAR":return s.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:l=>{if(l.length===2){const[s,o]=l;return s==null||o==null?null:s.toString().substring(o-1)}if(l.length===3){const[s,o,f]=l;return s==null||o==null||f==null?null:f<=0?"":s.toString().substring(o-1,o+f-1)}}},position:{minParams:2,maxParams:2,evaluate:([l,s])=>l==null||s==null?null:s.indexOf(l)+1},trim:{minParams:2,maxParams:3,evaluate:l=>{const s=l.length===3,o=s?l[1]:" ",f=s?l[2]:l[1];if(o==null||f==null)return null;const i=`(${_o(o)})`;switch(l[0]){case"BOTH":return f.replaceAll(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return f.replaceAll(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return f.replaceAll(new RegExp(`${i}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.abs(l[0])},ceiling:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.ceil(l[0])},floor:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.floor(l[0])},log:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])},log10:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sin(l[0])},cos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cos(l[0])},tan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tan(l[0])},asin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.asin(l[0])},acos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.acos(l[0])},atan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.atan(l[0])},sign:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0]>0?1:l[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]**l[1]},mod:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]%l[1]},round:{minParams:1,maxParams:2,evaluate:l=>{const s=l[0],o=l.length===2?10**l[1]:1;return s==null?null:Math.round(s*o)/o}},truncate:{minParams:1,maxParams:2,evaluate:l=>l[0]==null?null:l.length===1?parseInt(l[0].toFixed(0),10):parseFloat(l[0].toFixed(l[1]))},char_length:{minParams:1,maxParams:1,evaluate:l=>typeof l[0]=="string"||l[0]instanceof String?l[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:l=>{let s="";for(let o=0;o<l.length;o++){if(l[o]==null)return null;s+=l[o].toString()}return s}},lower:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:l=>{for(const s of l)if(s!==null)return s;return null}},cosh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cosh(l[0])},sinh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sinh(l[0])},tanh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tanh(l[0])},nullif:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];return(s instanceof Date?s.valueOf():s)===(o instanceof Date?o.valueOf():o)?null:s}},cast:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];if(s===null)return null;switch(o.type){case"integer":{const f=parseInt(s,10);if(isNaN(f))throw new j(C.CannotCastValue);return f}case"smallint":{const f=parseInt(s,10);if(isNaN(f))throw new j(C.CannotCastValue);if(f>32767||f<-32767)throw new j(C.CannotCastValue);return f}case"float":case"real":{const f=parseFloat(s);if(isNaN(f))throw new j(C.CannotCastValue);return f}case"date":return Ft(s,!0);case"timestamp":return Ft(s,!1);case"varchar":{const f=s.toString();if(f.length>o.size)throw new j(C.CannotCastValue);return f}default:throw new j(C.InvalidDataType)}}}};var Pt,_t,Se={exports:{}};Se.exports,_t=function(){function l(i,d){function m(){this.constructor=i}m.prototype=d.prototype,i.prototype=new m}function s(i,d,m,t){var N=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(N,s.prototype),N.expected=d,N.found=m,N.location=t,N.name="SyntaxError",N}function o(i,d,m){return m=m||" ",i.length>d?i:(d-=i.length,i+(m+=m.repeat(d)).slice(0,d))}function f(i,d){var m,t={},N=(d=d!==void 0?d:{}).grammarSource,b={start:Ye},_=Ye,V="!",O="=",T=">=",S=">",L="<=",E="<>",Gt="<",Me="!=",pe="+",de="-",Re="||",Wt="*",Yt="/",Kt="@",De="'",Oe="N'",X="''",Qt=".",Zt="null",Xt="true",er="false",tr="in",rr="is",nr="like",ar="escape",sr="not",ur="and",or="or",ir="between",lr="from",cr="for",fr="substring",pr="extract",dr="trim",vr="position",hr="timestamp",mr="date",gr="leading",yr="trailing",wr="both",Nr="cast",Ir="as",br="integer",Tr="smallint",xr="float",Ar="real",Sr="varchar",Er="to",Cr="interval",Fr="year",Pr="month",_r="day",Lr="hour",Mr="minute",Rr="second",Dr="case",Or="end",$r="when",Jr="then",Ur="else",kr=",",Vr="(",qr=")",$e="`",Hr=/^[A-Za-z_\x80-\uFFFF]/,Br=/^[A-Za-z0-9_]/,jr=/^[A-Za-z0-9_.\x80-\uFFFF]/,Je=/^[^']/,zr=/^[0-9]/,Gr=/^[eE]/,Wr=/^[+\-]/,Yr=/^[ \t\n\r]/,Ue=/^[^`]/,Kr=g("!",!1),ke=g("=",!1),Qr=g(">=",!1),Zr=g(">",!1),Xr=g("<=",!1),en=g("<>",!1),tn=g("<",!1),rn=g("!=",!1),ve=g("+",!1),he=g("-",!1),nn=g("||",!1),an=g("*",!1),sn=g("/",!1),un=$([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),on=$([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),ln=$([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),cn=g("@",!1),Ve=g("'",!1),fn=g("N'",!1),qe=g("''",!1),He=$(["'"],!0,!1),pn=g(".",!1),dn=$([["0","9"]],!1,!1),vn=$(["e","E"],!1,!1),hn=$(["+","-"],!1,!1),mn=g("NULL",!0),gn=g("TRUE",!0),yn=g("FALSE",!0),wn=g("IN",!0),Nn=g("IS",!0),In=g("LIKE",!0),bn=g("ESCAPE",!0),Tn=g("NOT",!0),xn=g("AND",!0),An=g("OR",!0),Sn=g("BETWEEN",!0),En=g("FROM",!0),Cn=g("FOR",!0),Fn=g("SUBSTRING",!0),Pn=g("EXTRACT",!0),_n=g("TRIM",!0),Ln=g("POSITION",!0),Mn=g("TIMESTAMP",!0),Rn=g("DATE",!0),Dn=g("LEADING",!0),On=g("TRAILING",!0),$n=g("BOTH",!0),Jn=g("CAST",!0),Un=g("AS",!0),kn=g("INTEGER",!0),Vn=g("SMALLINT",!0),qn=g("FLOAT",!0),Hn=g("REAL",!0),Bn=g("VARCHAR",!0),jn=g("TO",!0),zn=g("INTERVAL",!0),Gn=g("YEAR",!0),Wn=g("MONTH",!0),Yn=g("DAY",!0),Kn=g("HOUR",!0),Qn=g("MINUTE",!0),Zn=g("SECOND",!0),Xn=g("CASE",!0),ea=g("END",!0),ta=g("WHEN",!0),ra=g("THEN",!0),na=g("ELSE",!0),aa=g(",",!1),sa=g("(",!1),ua=g(")",!1),oa=$([" ","	",`
`,"\r"],!1,!1),Be=g("`",!1),je=$(["`"],!0,!1),ia=function(e){return e},la=function(e,n){var a={type:"expression-list"},u=Po(e,n);return a.value=u,a},ca=function(e,n){return Q(e,n)},fa=function(e,n){return Q(e,n)},pa=function(e){return Co("NOT",e)},da=function(e,n){return n==""||n==null||n==null?e:n.type=="arithmetic"?Q(e,n.tail):At(n.op,e,n.right,n.escape)},va=function(e){return{type:"arithmetic",tail:e}},ha=function(e,n){return{op:e+"NOT",right:n}},ma=function(e,n){return{op:e,right:n}},ga=function(e,n,a){return{op:"NOT"+e,right:{type:"expression-list",value:[n,a]}}},ya=function(e,n,a){return{op:e,right:{type:"expression-list",value:[n,a]}}},wa=function(e){return e[0]+" "+e[2]},Na=function(e){return e[0]+" "+e[2]},Ia=function(e,n,a){return{op:e,right:n,escape:a.value}},ba=function(e,n){return{op:e,right:n,escape:""}},Ta=function(e,n){return{op:e,right:n}},xa=function(e){return{op:e,right:{type:"expression-list",value:[]}}},Aa=function(e,n){return{op:e,right:n}},Sa=function(e,n){return Q(e,n)},Ea=function(e,n){return Q(e,n)},Ca=function(e){return e.paren=!0,e},Fa=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:e}},Pa=function(e){return e},_a=function(e,n){return e+n.join("")},La=function(e,n){return e+n.join("")},Ma=function(e){return{type:"parameter",value:e[1]}},Ra=function(e,n){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:e},n]}}},Da=function(e,n,a){return{type:"function",name:"substring",args:{type:"expression-list",value:a?[e,n,a[2]]:[e,n]}}},Oa=function(e,n){return{type:"function",name:"cast",args:{type:"expression-list",value:[e,n]}}},$a=function(){return{type:"data-type",value:{type:"integer"}}},Ja=function(){return{type:"data-type",value:{type:"smallint"}}},Ua=function(){return{type:"data-type",value:{type:"float"}}},ka=function(){return{type:"data-type",value:{type:"real"}}},Va=function(){return{type:"data-type",value:{type:"date"}}},qa=function(){return{type:"data-type",value:{type:"timestamp"}}},Ha=function(e){return{type:"data-type",value:{type:"varchar",size:parseInt(e)}}},Ba=function(e,n,a){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:e??"BOTH"},n,a]}}},ja=function(e,n){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:e??"BOTH"},n]}}},za=function(e,n){return{type:"function",name:"position",args:{type:"expression-list",value:[e,n]}}},Ga=function(e,n){return{type:"function",name:e,args:n||{type:"expression-list",value:[]}}},Wa=function(e){return{type:"timestamp",value:e.value}},Ya=function(e,n,a){return{type:"interval",value:n,qualifier:a,op:e}},Ka=function(e,n){return{type:"interval",value:e,qualifier:n,op:""}},Qa=function(e,n){return{type:"interval-qualifier",start:e,end:n}},Za=function(e,n){return{type:"interval-period",period:e.value,precision:n,secondary:null}},Xa=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},es=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},ts=function(e,n){return{type:"interval-period",period:"second",precision:e,secondary:n}},rs=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},ns=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},as=function(e,n){return{type:"interval-period",period:e.value,precision:n,secondary:null}},ss=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},us=function(e,n){return{type:"interval-period",period:"second",precision:e,secondary:n}},os=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},is=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},ls=function(){return{type:"string",value:"day"}},cs=function(){return{type:"string",value:"hour"}},fs=function(){return{type:"string",value:"minute"}},ps=function(){return{type:"string",value:"month"}},ds=function(){return{type:"string",value:"year"}},vs=function(e){return parseFloat(e)},hs=function(e){return parseFloat(e)},ms=function(e){return{type:"date",value:e.value}},gs=function(){return{type:"null",value:null}},ys=function(){return{type:"boolean",value:!0}},ws=function(){return{type:"boolean",value:!1}},ze=function(){return"'"},Ns=function(e){return{type:"string",value:e.join("")}},Is=function(e,n){return{type:"case-expression",format:"simple",operand:e,clauses:n,else:null}},bs=function(e,n,a){return{type:"case-expression",format:"simple",operand:e,clauses:n,else:a.value}},Ts=function(e){return{type:"case-expression",format:"searched",clauses:e,else:null}},xs=function(e,n){return{type:"case-expression",format:"searched",clauses:e,else:n.value}},As=function(e,n){return{type:"when-clause",operand:e,value:n}},Ss=function(e,n){return{type:"when-clause",operand:e,value:n}},Es=function(e){return{type:"else-clause",value:e}},Cs=function(e){return{type:"number",value:e}},Fs=function(e,n,a){return parseFloat(e+n+a)},Ps=function(e,n){return parseFloat(e+n)},_s=function(e,n){return parseFloat(e+n)},Ls=function(e){return parseFloat(e)},Ms=function(e,n){return e[0]+n},Rs=function(e){return"."+(e??"")},Ds=function(e,n){return e+n},Os=function(e){return e.join("")},$s=function(e,n){return"e"+(n===null?"":n)},Js=function(){return"IN"},Us=function(){return"IS"},ks=function(){return"LIKE"},Vs=function(){return"ESCAPE"},qs=function(){return"NOT"},Hs=function(){return"AND"},Bs=function(){return"OR"},js=function(){return"BETWEEN"},zs=function(){return"FROM"},Gs=function(){return"FOR"},Ws=function(){return"SUBSTRING"},Ys=function(){return"EXTRACT"},Ks=function(){return"TRIM"},Qs=function(){return"POSITION"},Zs=function(){return"TIMESTAMP"},Xs=function(){return"DATE"},eu=function(){return"LEADING"},tu=function(){return"TRAILING"},ru=function(){return"BOTH"},nu=function(){return"CAST"},au=function(){return"AS"},su=function(){return"INTEGER"},uu=function(){return"SMALLINT"},ou=function(){return"FLOAT"},iu=function(){return"REAL"},lu=function(){return"VARCHAR"},cu=function(){return"TO"},fu=function(){return"INTERVAL"},pu=function(){return"YEAR"},du=function(){return"MONTH"},vu=function(){return"DAY"},hu=function(){return"HOUR"},mu=function(){return"MINUTE"},gu=function(){return"SECOND"},yu=function(){return"CASE"},wu=function(){return"END"},Nu=function(){return"WHEN"},Iu=function(){return"THEN"},bu=function(){return"ELSE"},Tu=function(e){return e},xu=function(e){return e.join("")},r=0,ee=[{line:1,column:1}],R=0,me=[],c=0;if("startRule"in d){if(!(d.startRule in b))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');_=b[d.startRule]}function g(e,n){return{type:"literal",text:e,ignoreCase:n}}function $(e,n,a){return{type:"class",parts:e,inverted:n,ignoreCase:a}}function Au(){return{type:"end"}}function Ge(e){var n,a=ee[e];if(a)return a;for(n=e-1;!ee[n];)n--;for(a={line:(a=ee[n]).line,column:a.column};n<e;)i.charCodeAt(n)===10?(a.line++,a.column=1):a.column++,n++;return ee[e]=a,a}function We(e,n,a){var u=Ge(e),h=Ge(n),w={source:N,start:{offset:e,line:u.line,column:u.column},end:{offset:n,line:h.line,column:h.column}};return w}function v(e){r<R||(r>R&&(R=r,me=[]),me.push(e))}function Su(e,n,a){return new s(s.buildMessage(e,n),e,n,a)}function Ye(){var e,n;return e=r,p(),(n=A())!==t?(p(),e=ia(n)):(r=e,e=t),e}function Ke(){var e,n,a,u,h,w,I,x;if(e=r,(n=A())!==t){for(a=[],u=r,h=p(),(w=ce())!==t?(I=p(),(x=A())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);u!==t;)a.push(u),u=r,h=p(),(w=ce())!==t?(I=p(),(x=A())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);e=la(n,a)}else r=e,e=t;return e}function A(){var e,n,a,u,h,w,I,x;if(e=r,(n=ge())!==t){for(a=[],u=r,h=p(),(w=ft())!==t?(I=p(),(x=ge())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);u!==t;)a.push(u),u=r,h=p(),(w=ft())!==t?(I=p(),(x=ge())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);e=ca(n,a)}else r=e,e=t;return e}function ge(){var e,n,a,u,h,w,I,x;if(e=r,(n=te())!==t){for(a=[],u=r,h=p(),(w=oe())!==t?(I=p(),(x=te())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);u!==t;)a.push(u),u=r,h=p(),(w=oe())!==t?(I=p(),(x=te())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);e=fa(n,a)}else r=e,e=t;return e}function te(){var e,n,a,u,h;return e=r,(n=K())===t&&(n=r,i.charCodeAt(r)===33?(a=V,r++):(a=t,c===0&&v(Kr)),a!==t?(u=r,c++,i.charCodeAt(r)===61?(h=O,r++):(h=t,c===0&&v(ke)),c--,h===t?u=void 0:(r=u,u=t),u!==t?n=a=[a,u]:(r=n,n=t)):(r=n,n=t)),n!==t?(a=p(),(u=te())!==t?e=pa(u):(r=e,e=t)):(r=e,e=t),e===t&&(e=Eu()),e}function Eu(){var e,n,a;return e=r,(n=J())!==t?(p(),(a=Cu())===t&&(a=null),e=da(n,a)):(r=e,e=t),e}function Cu(){var e;return(e=Fu())===t&&(e=Mu())===t&&(e=_u())===t&&(e=Pu())===t&&(e=Lu()),e}function Fu(){var e,n,a,u,h,w;if(e=[],n=r,a=p(),(u=Qe())!==t?(h=p(),(w=J())!==t?n=a=[a,u,h,w]:(r=n,n=t)):(r=n,n=t),n!==t)for(;n!==t;)e.push(n),n=r,a=p(),(u=Qe())!==t?(h=p(),(w=J())!==t?n=a=[a,u,h,w]:(r=n,n=t)):(r=n,n=t);else e=t;return e!==t&&(e=va(e)),e}function Qe(){var e;return i.substr(r,2)===T?(e=T,r+=2):(e=t,c===0&&v(Qr)),e===t&&(i.charCodeAt(r)===62?(e=S,r++):(e=t,c===0&&v(Zr)),e===t&&(i.substr(r,2)===L?(e=L,r+=2):(e=t,c===0&&v(Xr)),e===t&&(i.substr(r,2)===E?(e=E,r+=2):(e=t,c===0&&v(en)),e===t&&(i.charCodeAt(r)===60?(e=Gt,r++):(e=t,c===0&&v(tn)),e===t&&(i.charCodeAt(r)===61?(e=O,r++):(e=t,c===0&&v(ke)),e===t&&(i.substr(r,2)===Me?(e=Me,r+=2):(e=t,c===0&&v(rn)))))))),e}function Pu(){var e,n,a,u;return e=r,(n=lt())!==t?(p(),(a=K())!==t?(p(),(u=J())!==t?e=ha(n,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=lt())!==t?(p(),(a=J())!==t?e=ma(n,a):(r=e,e=t)):(r=e,e=t)),e}function _u(){var e,n,a,u,h,w;return e=r,(n=K())!==t?(p(),(a=pt())!==t?(p(),(u=J())!==t?(p(),(h=oe())!==t?(p(),(w=J())!==t?e=ga(a,u,w):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=pt())!==t?(p(),(a=J())!==t?(p(),(u=oe())!==t?(p(),(h=J())!==t?e=ya(n,a,h):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)),e}function Ze(){var e,n,a,u,h;return e=r,n=r,(a=K())!==t?(u=p(),(h=ct())!==t?n=a=[a,u,h]:(r=n,n=t)):(r=n,n=t),n!==t&&(n=wa(n)),(e=n)===t&&(e=ct()),e}function ye(){var e,n,a,u,h;return e=r,n=r,(a=K())!==t?(u=p(),(h=xe())!==t?n=a=[a,u,h]:(r=n,n=t)):(r=n,n=t),n!==t&&(n=Na(n)),(e=n)===t&&(e=xe()),e}function Lu(){var e,n,a,u;return e=r,(n=Ze())!==t?(p(),(a=W())!==t?(p(),lo()!==t?(p(),(u=Te())!==t?e=Ia(n,a,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=Ze())!==t?(p(),(a=W())!==t?e=ba(n,a):(r=e,e=t)):(r=e,e=t)),e}function Mu(){var e,n,a,u;return e=r,(n=ye())!==t?(p(),(a=F())!==t?(p(),(u=Ke())!==t?(p(),P()!==t?e=Ta(n,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=ye())!==t?(p(),(a=F())!==t?(p(),(u=P())!==t?e=xa(n):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=ye())!==t?(p(),(a=be())!==t?e=Aa(n,a):(r=e,e=t)):(r=e,e=t))),e}function J(){var e,n,a,u,h,w,I,x;if(e=r,(n=we())!==t){for(a=[],u=r,h=p(),(w=Xe())!==t?(I=p(),(x=we())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);u!==t;)a.push(u),u=r,h=p(),(w=Xe())!==t?(I=p(),(x=we())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);e=Sa(n,a)}else r=e,e=t;return e}function Xe(){var e;return i.charCodeAt(r)===43?(e=pe,r++):(e=t,c===0&&v(ve)),e===t&&(i.charCodeAt(r)===45?(e=de,r++):(e=t,c===0&&v(he)),e===t&&(i.substr(r,2)===Re?(e=Re,r+=2):(e=t,c===0&&v(nn)))),e}function we(){var e,n,a,u,h,w,I,x;if(e=r,(n=Ne())!==t){for(a=[],u=r,h=p(),(w=et())!==t?(I=p(),(x=Ne())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);u!==t;)a.push(u),u=r,h=p(),(w=et())!==t?(I=p(),(x=Ne())!==t?u=h=[h,w,I,x]:(r=u,u=t)):(r=u,u=t);e=Ea(n,a)}else r=e,e=t;return e}function et(){var e;return i.charCodeAt(r)===42?(e=Wt,r++):(e=t,c===0&&v(an)),e===t&&(i.charCodeAt(r)===47?(e=Yt,r++):(e=t,c===0&&v(sn))),e}function Ne(){var e,n;return(e=ju())===t&&(e=$u())===t&&(e=Ju())===t&&(e=Vu())===t&&(e=qu())===t&&(e=Uu())===t&&(e=Hu())===t&&(e=eo())===t&&(e=Ru())===t&&(e=be())===t&&(e=r,F()!==t?(p(),(n=A())!==t?(p(),P()!==t?e=Ca(n):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)),e}function Ru(){var e;return(e=Du())!==t&&(e=Fa(e)),e}function Du(){var e;return(e=Ou())!==t&&(e=Pa(e)),e}function Ou(){var e,n,a,u;if(e=r,(n=Ie())!==t){for(a=[],u=rt();u!==t;)a.push(u),u=rt();e=_a(n,a)}else r=e,e=t;return e}function tt(){var e,n,a,u;if(e=r,(n=Ie())!==t){for(a=[],u=y();u!==t;)a.push(u),u=y();e=La(n,a)}else r=e,e=t;return e}function Ie(){var e;return Hr.test(i.charAt(r))?(e=i.charAt(r),r++):(e=t,c===0&&v(un)),e}function y(){var e;return Br.test(i.charAt(r))?(e=i.charAt(r),r++):(e=t,c===0&&v(on)),e}function rt(){var e;return jr.test(i.charAt(r))?(e=i.charAt(r),r++):(e=t,c===0&&v(ln)),e}function be(){var e,n,a;return e=r,i.charCodeAt(r)===64?(n=Kt,r++):(n=t,c===0&&v(cn)),n!==t&&(a=tt())!==t?e=n=[n,a]:(r=e,e=t),e!==t&&(e=Ma(e)),e}function $u(){var e,n,a;return e=r,po()!==t?(p(),F()!==t?(p(),(n=Bu())!==t?(p(),Ae()!==t?(p(),(a=A())!==t?(p(),P()!==t?e=Ra(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function Ju(){var e,n,a,u,h,w,I;return e=r,fo()!==t?(p(),F()!==t?(p(),(n=A())!==t?(p(),Ae()!==t?(p(),(a=A())!==t?(p(),u=r,(h=co())!==t?(w=p(),(I=A())!==t?u=h=[h,w,I,p()]:(r=u,u=t)):(r=u,u=t),u===t&&(u=null),(h=P())!==t?e=Da(n,a,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function Uu(){var e,n,a;return e=r,yo()!==t?(p(),F()!==t?(p(),(n=A())!==t?(p(),wo()!==t?(p(),(a=ku())!==t?(p(),P()!==t?e=Oa(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function ku(){var e,n,a;return e=r,(n=No())!==t&&(n=$a()),(e=n)===t&&(e=r,(n=Io())!==t&&(n=Ja()),(e=n)===t&&(e=r,(n=bo())!==t&&(n=Ua()),(e=n)===t&&(e=r,(n=To())!==t&&(n=ka()),(e=n)===t&&(e=r,(n=ht())!==t&&(n=Va()),(e=n)===t&&(e=r,(n=vt())!==t&&(n=qa()),(e=n)===t&&(e=r,(n=xo())!==t?(p(),F()!==t?(p(),(a=q())!==t?(p(),P()!==t?e=Ha(a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t))))))),e}function Vu(){var e,n,a,u;return e=r,dt()!==t?(p(),F()!==t?(p(),(n=nt())===t&&(n=null),p(),(a=A())!==t?(p(),Ae()!==t?(p(),(u=A())!==t?(p(),P()!==t?e=Ba(n,a,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,dt()!==t?(p(),F()!==t?(p(),(n=nt())===t&&(n=null),p(),(a=A())!==t?(p(),P()!==t?e=ja(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)),e}function nt(){var e;return(e=ho())===t&&(e=mo())===t&&(e=go()),e}function qu(){var e,n,a;return e=r,vo()!==t?(p(),F()!==t?(p(),(n=A())!==t?(p(),xe()!==t?(p(),(a=A())!==t?(p(),P()!==t?e=za(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function Hu(){var e,n,a;return e=r,(n=Eo())!==t?(p(),F()!==t?(p(),(a=Ke())===t&&(a=null),p(),P()!==t?e=Ga(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function Bu(){var e;return(e=gt())===t&&(e=yt())===t&&(e=wt())===t&&(e=Nt())===t&&(e=It())===t&&(e=H()),e}function ju(){var e;return(e=Te())===t&&(e=no())===t&&(e=Xu())===t&&(e=Zu())===t&&(e=Qu())===t&&(e=zu())===t&&(e=Gu()),e}function zu(){var e,n;return e=r,vt()!==t?(p(),(n=W())!==t?e=Wa(n):(r=e,e=t)):(r=e,e=t),e}function Gu(){var e,n,a,u;return e=r,mt()!==t?(p(),i.charCodeAt(r)===45?(n=de,r++):(n=t,c===0&&v(he)),n===t&&(i.charCodeAt(r)===43?(n=pe,r++):(n=t,c===0&&v(ve))),n!==t?(p(),(a=W())!==t?(p(),(u=at())!==t?e=Ya(n,a,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,mt()!==t?(p(),(n=W())!==t?(p(),(a=at())!==t?e=Ka(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)),e}function at(){var e,n,a;return e=r,(n=Wu())!==t?(p(),Ao()!==t?(p(),(a=Yu())!==t?e=Qa(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=Ku()),e}function Wu(){var e,n,a;return e=r,(n=Y())!==t?(p(),F()!==t?(p(),(a=ne())!==t?(p(),P()!==t?e=Za(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=Y())!==t&&(n=Xa(n)),e=n),e}function Yu(){var e,n,a,u;return e=r,(n=Y())!==t&&(n=es(n)),(e=n)===t&&(e=r,(n=H())!==t?(p(),F()!==t?(p(),(a=ne())!==t?(p(),ce()!==t?(p(),(u=re())!==t?(p(),P()!==t?e=ts(a,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=H())!==t?(p(),F()!==t?(p(),(a=ne())!==t?(p(),P()!==t?e=rs(a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=H())!==t&&(n=ns()),e=n))),e}function Ku(){var e,n,a,u;return e=r,(n=Y())!==t?(p(),F()!==t?(p(),(a=re())!==t?(p(),P()!==t?e=as(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=Y())!==t&&(n=ss(n)),(e=n)===t&&(e=r,(n=H())!==t?(p(),F()!==t?(p(),(a=ne())!==t?(p(),ce()!==t?(p(),(u=re())!==t?(p(),P()!==t?e=us(a,u):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=H())!==t?(p(),F()!==t?(p(),(a=re())!==t?(p(),P()!==t?e=os(a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e===t&&(e=r,(n=H())!==t&&(n=is()),e=n)))),e}function Y(){var e,n;return e=r,(n=wt())!==t&&(n=ls()),(e=n)===t&&(e=r,(n=Nt())!==t&&(n=cs()),(e=n)===t&&(e=r,(n=It())!==t&&(n=fs()),(e=n)===t&&(e=r,(n=yt())!==t&&(n=ps()),(e=n)===t&&(e=r,(n=gt())!==t&&(n=ds()),e=n)))),e}function re(){var e;return(e=q())!==t&&(e=vs(e)),e}function ne(){var e;return(e=q())!==t&&(e=hs(e)),e}function Qu(){var e,n;return e=r,ht()!==t?(p(),(n=W())!==t?e=ms(n):(r=e,e=t)):(r=e,e=t),e}function Zu(){var e;return(e=uo())!==t&&(e=gs()),e}function Xu(){var e,n;return e=r,(n=oo())!==t&&(n=ys()),(e=n)===t&&(e=r,(n=io())!==t&&(n=ws()),e=n),e}function W(){var e;return(e=Te())===t&&(e=be()),e}function Te(){var e,n,a,u,h;if(e=r,i.charCodeAt(r)===39?(n=De,r++):(n=t,c===0&&v(Ve)),n===t&&(i.substr(r,2)===Oe?(n=Oe,r+=2):(n=t,c===0&&v(fn))),n!==t){for(a=[],u=r,i.substr(r,2)===X?(h=X,r+=2):(h=t,c===0&&v(qe)),h!==t&&(h=ze()),(u=h)===t&&(Je.test(i.charAt(r))?(u=i.charAt(r),r++):(u=t,c===0&&v(He)));u!==t;)a.push(u),u=r,i.substr(r,2)===X?(h=X,r+=2):(h=t,c===0&&v(qe)),h!==t&&(h=ze()),(u=h)===t&&(Je.test(i.charAt(r))?(u=i.charAt(r),r++):(u=t,c===0&&v(He)));i.charCodeAt(r)===39?(u=De,r++):(u=t,c===0&&v(Ve)),u!==t?e=Ns(a):(r=e,e=t)}else r=e,e=t;return e}function eo(){var e;return(e=to())===t&&(e=ro()),e}function to(){var e,n,a,u,h;if(e=r,ie()!==t)if(p(),(n=A())!==t){for(p(),a=[],u=se();u!==t;)a.push(u),u=se();u=p(),(h=le())!==t?e=Is(n,a):(r=e,e=t)}else r=e,e=t;else r=e,e=t;if(e===t)if(e=r,ie()!==t)if(p(),(n=A())!==t){for(p(),a=[],u=se();u!==t;)a.push(u),u=se();u=p(),(h=st())!==t?(p(),le()!==t?e=bs(n,a,h):(r=e,e=t)):(r=e,e=t)}else r=e,e=t;else r=e,e=t;return e}function ro(){var e,n,a,u;if(e=r,ie()!==t){for(p(),n=[],a=ae();a!==t;)n.push(a),a=ae();a=p(),(u=le())!==t?e=Ts(n):(r=e,e=t)}else r=e,e=t;if(e===t)if(e=r,ie()!==t){for(p(),n=[],a=ae();a!==t;)n.push(a),a=ae();a=p(),(u=st())!==t?(p(),le()!==t?e=xs(n,u):(r=e,e=t)):(r=e,e=t)}else r=e,e=t;return e}function ae(){var e,n,a;return e=r,bt()!==t?(p(),(n=A())!==t?(p(),Tt()!==t?(p(),(a=A())!==t?e=As(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function se(){var e,n,a;return e=r,bt()!==t?(p(),(n=A())!==t?(p(),Tt()!==t?(p(),(a=A())!==t?e=Ss(n,a):(r=e,e=t)):(r=e,e=t)):(r=e,e=t)):(r=e,e=t),e}function st(){var e,n;return e=r,So()!==t?(p(),(n=A())!==t?e=Es(n):(r=e,e=t)):(r=e,e=t),e}function no(){var e,n,a,u;return e=r,(n=ao())!==t?(a=r,c++,u=Ie(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Cs(n):(r=e,e=t)):(r=e,e=t),e}function ao(){var e,n,a,u;return e=r,(n=ue())!==t&&(a=ut())!==t&&(u=ot())!==t?e=Fs(n,a,u):(r=e,e=t),e===t&&(e=r,(n=ue())!==t&&(a=ut())!==t?e=Ps(n,a):(r=e,e=t),e===t&&(e=r,(n=ue())!==t&&(a=ot())!==t?e=_s(n,a):(r=e,e=t),e===t&&(e=r,(n=ue())!==t&&(n=Ls(n)),e=n))),e}function ue(){var e,n,a;return(e=q())===t&&(e=r,i.charCodeAt(r)===45?(n=de,r++):(n=t,c===0&&v(he)),n===t&&(i.charCodeAt(r)===43?(n=pe,r++):(n=t,c===0&&v(ve))),n!==t&&(a=q())!==t?e=Ms(n,a):(r=e,e=t)),e}function ut(){var e,n,a;return e=r,i.charCodeAt(r)===46?(n=Qt,r++):(n=t,c===0&&v(pn)),n!==t?((a=q())===t&&(a=null),e=Rs(a)):(r=e,e=t),e}function ot(){var e,n,a;return e=r,(n=so())!==t&&(a=q())!==t?e=Ds(n,a):(r=e,e=t),e}function q(){var e,n;if(e=[],(n=it())!==t)for(;n!==t;)e.push(n),n=it();else e=t;return e!==t&&(e=Os(e)),e}function it(){var e;return zr.test(i.charAt(r))?(e=i.charAt(r),r++):(e=t,c===0&&v(dn)),e}function so(){var e,n,a;return e=r,Gr.test(i.charAt(r))?(n=i.charAt(r),r++):(n=t,c===0&&v(vn)),n!==t?(Wr.test(i.charAt(r))?(a=i.charAt(r),r++):(a=t,c===0&&v(hn)),a===t&&(a=null),e=$s(n,a)):(r=e,e=t),e}function uo(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Zt?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(mn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=n=[n,a]:(r=e,e=t)):(r=e,e=t),e}function oo(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Xt?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(gn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=n=[n,a]:(r=e,e=t)):(r=e,e=t),e}function io(){var e,n,a,u;return e=r,i.substr(r,5).toLowerCase()===er?(n=i.substr(r,5),r+=5):(n=t,c===0&&v(yn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=n=[n,a]:(r=e,e=t)):(r=e,e=t),e}function xe(){var e,n,a,u;return e=r,i.substr(r,2).toLowerCase()===tr?(n=i.substr(r,2),r+=2):(n=t,c===0&&v(wn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Js():(r=e,e=t)):(r=e,e=t),e}function lt(){var e,n,a,u;return e=r,i.substr(r,2).toLowerCase()===rr?(n=i.substr(r,2),r+=2):(n=t,c===0&&v(Nn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Us():(r=e,e=t)):(r=e,e=t),e}function ct(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===nr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(In)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=ks():(r=e,e=t)):(r=e,e=t),e}function lo(){var e,n,a,u;return e=r,i.substr(r,6).toLowerCase()===ar?(n=i.substr(r,6),r+=6):(n=t,c===0&&v(bn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Vs():(r=e,e=t)):(r=e,e=t),e}function K(){var e,n,a,u;return e=r,i.substr(r,3).toLowerCase()===sr?(n=i.substr(r,3),r+=3):(n=t,c===0&&v(Tn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=qs():(r=e,e=t)):(r=e,e=t),e}function oe(){var e,n,a,u;return e=r,i.substr(r,3).toLowerCase()===ur?(n=i.substr(r,3),r+=3):(n=t,c===0&&v(xn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Hs():(r=e,e=t)):(r=e,e=t),e}function ft(){var e,n,a,u;return e=r,i.substr(r,2).toLowerCase()===or?(n=i.substr(r,2),r+=2):(n=t,c===0&&v(An)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Bs():(r=e,e=t)):(r=e,e=t),e}function pt(){var e,n,a,u;return e=r,i.substr(r,7).toLowerCase()===ir?(n=i.substr(r,7),r+=7):(n=t,c===0&&v(Sn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=js():(r=e,e=t)):(r=e,e=t),e}function Ae(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===lr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(En)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=zs():(r=e,e=t)):(r=e,e=t),e}function co(){var e,n,a,u;return e=r,i.substr(r,3).toLowerCase()===cr?(n=i.substr(r,3),r+=3):(n=t,c===0&&v(Cn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Gs():(r=e,e=t)):(r=e,e=t),e}function fo(){var e,n,a,u;return e=r,i.substr(r,9).toLowerCase()===fr?(n=i.substr(r,9),r+=9):(n=t,c===0&&v(Fn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Ws():(r=e,e=t)):(r=e,e=t),e}function po(){var e,n,a,u;return e=r,i.substr(r,7).toLowerCase()===pr?(n=i.substr(r,7),r+=7):(n=t,c===0&&v(Pn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Ys():(r=e,e=t)):(r=e,e=t),e}function dt(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===dr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(_n)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Ks():(r=e,e=t)):(r=e,e=t),e}function vo(){var e,n,a,u;return e=r,i.substr(r,8).toLowerCase()===vr?(n=i.substr(r,8),r+=8):(n=t,c===0&&v(Ln)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Qs():(r=e,e=t)):(r=e,e=t),e}function vt(){var e,n,a,u;return e=r,i.substr(r,9).toLowerCase()===hr?(n=i.substr(r,9),r+=9):(n=t,c===0&&v(Mn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Zs():(r=e,e=t)):(r=e,e=t),e}function ht(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===mr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(Rn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Xs():(r=e,e=t)):(r=e,e=t),e}function ho(){var e,n,a,u;return e=r,i.substr(r,7).toLowerCase()===gr?(n=i.substr(r,7),r+=7):(n=t,c===0&&v(Dn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=eu():(r=e,e=t)):(r=e,e=t),e}function mo(){var e,n,a,u;return e=r,i.substr(r,8).toLowerCase()===yr?(n=i.substr(r,8),r+=8):(n=t,c===0&&v(On)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=tu():(r=e,e=t)):(r=e,e=t),e}function go(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===wr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v($n)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=ru():(r=e,e=t)):(r=e,e=t),e}function yo(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Nr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(Jn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=nu():(r=e,e=t)):(r=e,e=t),e}function wo(){var e,n,a,u;return e=r,i.substr(r,2).toLowerCase()===Ir?(n=i.substr(r,2),r+=2):(n=t,c===0&&v(Un)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=au():(r=e,e=t)):(r=e,e=t),e}function No(){var e,n,a,u;return e=r,i.substr(r,7).toLowerCase()===br?(n=i.substr(r,7),r+=7):(n=t,c===0&&v(kn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=su():(r=e,e=t)):(r=e,e=t),e}function Io(){var e,n,a,u;return e=r,i.substr(r,8).toLowerCase()===Tr?(n=i.substr(r,8),r+=8):(n=t,c===0&&v(Vn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=uu():(r=e,e=t)):(r=e,e=t),e}function bo(){var e,n,a,u;return e=r,i.substr(r,5).toLowerCase()===xr?(n=i.substr(r,5),r+=5):(n=t,c===0&&v(qn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=ou():(r=e,e=t)):(r=e,e=t),e}function To(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Ar?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(Hn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=iu():(r=e,e=t)):(r=e,e=t),e}function xo(){var e,n,a,u;return e=r,i.substr(r,7).toLowerCase()===Sr?(n=i.substr(r,7),r+=7):(n=t,c===0&&v(Bn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=lu():(r=e,e=t)):(r=e,e=t),e}function Ao(){var e,n,a,u;return e=r,i.substr(r,2).toLowerCase()===Er?(n=i.substr(r,2),r+=2):(n=t,c===0&&v(jn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=cu():(r=e,e=t)):(r=e,e=t),e}function mt(){var e,n,a,u;return e=r,i.substr(r,8).toLowerCase()===Cr?(n=i.substr(r,8),r+=8):(n=t,c===0&&v(zn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=fu():(r=e,e=t)):(r=e,e=t),e}function gt(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Fr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(Gn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=pu():(r=e,e=t)):(r=e,e=t),e}function yt(){var e,n,a,u;return e=r,i.substr(r,5).toLowerCase()===Pr?(n=i.substr(r,5),r+=5):(n=t,c===0&&v(Wn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=du():(r=e,e=t)):(r=e,e=t),e}function wt(){var e,n,a,u;return e=r,i.substr(r,3).toLowerCase()===_r?(n=i.substr(r,3),r+=3):(n=t,c===0&&v(Yn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=vu():(r=e,e=t)):(r=e,e=t),e}function Nt(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Lr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(Kn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=hu():(r=e,e=t)):(r=e,e=t),e}function It(){var e,n,a,u;return e=r,i.substr(r,6).toLowerCase()===Mr?(n=i.substr(r,6),r+=6):(n=t,c===0&&v(Qn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=mu():(r=e,e=t)):(r=e,e=t),e}function H(){var e,n,a,u;return e=r,i.substr(r,6).toLowerCase()===Rr?(n=i.substr(r,6),r+=6):(n=t,c===0&&v(Zn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=gu():(r=e,e=t)):(r=e,e=t),e}function ie(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Dr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(Xn)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=yu():(r=e,e=t)):(r=e,e=t),e}function le(){var e,n,a,u;return e=r,i.substr(r,3).toLowerCase()===Or?(n=i.substr(r,3),r+=3):(n=t,c===0&&v(ea)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=wu():(r=e,e=t)):(r=e,e=t),e}function bt(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===$r?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(ta)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Nu():(r=e,e=t)):(r=e,e=t),e}function Tt(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Jr?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(ra)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=Iu():(r=e,e=t)):(r=e,e=t),e}function So(){var e,n,a,u;return e=r,i.substr(r,4).toLowerCase()===Ur?(n=i.substr(r,4),r+=4):(n=t,c===0&&v(na)),n!==t?(a=r,c++,u=y(),c--,u===t?a=void 0:(r=a,a=t),a!==t?e=bu():(r=e,e=t)):(r=e,e=t),e}function ce(){var e;return i.charCodeAt(r)===44?(e=kr,r++):(e=t,c===0&&v(aa)),e}function F(){var e;return i.charCodeAt(r)===40?(e=Vr,r++):(e=t,c===0&&v(sa)),e}function P(){var e;return i.charCodeAt(r)===41?(e=qr,r++):(e=t,c===0&&v(ua)),e}function p(){var e,n;for(e=[],n=xt();n!==t;)e.push(n),n=xt();return e}function xt(){var e;return Yr.test(i.charAt(r))?(e=i.charAt(r),r++):(e=t,c===0&&v(oa)),e}function Eo(){var e,n,a,u;if(e=r,(n=tt())!==t&&(n=Tu(n)),(e=n)===t)if(e=r,i.charCodeAt(r)===96?(n=$e,r++):(n=t,c===0&&v(Be)),n!==t){if(a=[],Ue.test(i.charAt(r))?(u=i.charAt(r),r++):(u=t,c===0&&v(je)),u!==t)for(;u!==t;)a.push(u),Ue.test(i.charAt(r))?(u=i.charAt(r),r++):(u=t,c===0&&v(je));else a=t;a!==t?(i.charCodeAt(r)===96?(u=$e,r++):(u=t,c===0&&v(Be)),u!==t?e=xu(a):(r=e,e=t)):(r=e,e=t)}else r=e,e=t;return e}function Co(e,n){return{type:"unary-expression",operator:e,expr:n}}function At(e,n,a,u){var h={type:"binary-expression",operator:e,left:n,right:a};return u!==void 0&&(h.escape=u),h}function Fo(e,n){for(var a=[e],u=0;u<n.length;u++)a.push(n[u][3]);return a}function Po(e,n,a){return Fo(e,n)}function Q(e,n){for(var a=e,u=0;u<n.length;u++)a=At(n[u][1],a,n[u][3]);return a}if((m=_())!==t&&r===i.length)return m;throw m!==t&&r<i.length&&v(Au()),Su(me,R<i.length?i.charAt(R):null,R<i.length?We(R,R+1):We(R,R))}return l(s,Error),s.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var m,t=null;for(m=0;m<i.length;m++)if(i[m].source===this.location.source){t=i[m].text.split(/\r\n|\n|\r/g);break}var N=this.location.start,b=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(N):N,_=this.location.source+":"+b.line+":"+b.column;if(t){var V=this.location.end,O=o("",b.line.toString().length," "),T=t[N.line-1],S=(N.line===V.line?V.column:T.length+1)-N.column||1;d+=`
 --> `+_+`
`+O+` |
`+b.line+" | "+T+`
`+O+" | "+o("",N.column-1," ")+o("",S,"^")}else d+=`
 at `+_}return d},s.buildMessage=function(i,d){var m={literal:function(T){return'"'+N(T.text)+'"'},class:function(T){var S=T.parts.map(function(L){return Array.isArray(L)?b(L[0])+"-"+b(L[1]):b(L)});return"["+(T.inverted?"^":"")+S.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(T){return T.description}};function t(T){return T.charCodeAt(0).toString(16).toUpperCase()}function N(T){return T.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(S){return"\\x0"+t(S)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(S){return"\\x"+t(S)})}function b(T){return T.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(S){return"\\x0"+t(S)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(S){return"\\x"+t(S)})}function _(T){return m[T.type](T)}function V(T){var S,L,E=T.map(_);if(E.sort(),E.length>0){for(S=1,L=1;S<E.length;S++)E[S-1]!==E[S]&&(E[L]=E[S],L++);E.length=L}switch(E.length){case 1:return E[0];case 2:return E[0]+" or "+E[1];default:return E.slice(0,-1).join(", ")+", or "+E[E.length-1]}}function O(T){return T?'"'+N(T)+'"':"end of input"}return"Expected "+V(i)+" but "+O(d)+" found."},{SyntaxError:s,parse:f}},(Pt=Se).exports&&(Pt.exports=_t());var Vo=Se.exports;let qo=class{static parse(s){return Vo.parse(s)}};const kt=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,Ho=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,Bo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,jo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,zo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,Go=new Set(["current_timestamp","current_date","current_time"]);function B(l,s){return(l+="").length>=s?l:new Array(s-l.length+1).join("0")+l}function Z(l,s,o="0",f="0",i="0",d="0",m="",t="0",N="0"){if(m==="+"||m==="-"){const b=`${B(parseInt(l,10),4)}-${B(parseInt(s,10),2)}-${B(parseInt(o,10),2)}`;let _="";parseFloat(d)<10&&(_="0");const V=`${B(parseInt(f,10),2)}:${B(parseInt(i,10),2)}:${_+parseFloat(d).toString()}`,O=`${m}${B(parseInt(t,10),2)}:${B(parseInt(N,10),2)}`;return new Date(b+"T"+V+O)}return new Date(parseInt(l,10),parseInt(s,10)-1,parseInt(o,10),parseInt(f,10),parseInt(i,10),parseFloat(d))}class Wo{static makeBool(s){return Vt(s)}static featureValue(s,o,f,i){return zt(s,o,f,i)}static equalsNull(s){return s===null}static applyLike(s,o,f){return Pe(s,o,f)}static ensureArray(s){return Ce(s)}static applyIn(s,o){return Fe(s,o)}static currentDate(){const s=new Date;return s.setHours(0,0,0,0),s}static makeSqlInterval(s,o,f){return k.createFromValueAndQualifer(s,o,f)}static convertInterval(s){return s instanceof k?s.valueInMilliseconds():s}static currentTimestamp(){return new Date}static compare(s,o,f){return Bt(s,o,f)}static calculate(s,o,f){return jt(s,o,f)}static makeComparable(s){return U(s)}static evaluateFunction(s,o){return _e(s,o)}static lookup(s,o){const f=o[s];return f===void 0?null:f}static between(s,o){return s==null||o[0]==null||o[1]==null?null:s>=o[0]&&s<=o[1]}static notbetween(s,o){return s==null||o[0]==null||o[1]==null?null:s<o[0]||s>o[1]}static ternaryNot(s){return fe(s)}static ternaryAnd(s,o){return qt(s,o)}static ternaryOr(s,o){return Ht(s,o)}}class Le{constructor(s,o){this.fieldsIndex=o,this._datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=qo.parse(s);const{isStandardized:f,isAggregate:i,referencedFieldNames:d}=this._extractExpressionInfo(o);this._referencedFieldNames=d,this.isStandardized=f,this.isAggregate=i}static create(s,o){return new Le(s,o)}get fieldNames(){return this._referencedFieldNames}testSet(s,o=z){const f={};for(const i of this.fieldNames)f[i]=s.map(d=>o.getAttribute(d,i));return!!this._evaluateNode(this.parseTree,{attributes:f},z)}calculateValue(s,o=z){const f=this._evaluateNode(this.parseTree,s,o);return f instanceof k?f.valueInMilliseconds()/864e5:f}calculateValueCompiled(s,o=z){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):St("esri-csp-restrictions")?this.calculateValue(s,o):(this._compileMe(),this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}testFeature(s,o=z){return!!this._evaluateNode(this.parseTree,s,o)}testFeatureCompiled(s,o=z){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):St("esri-csp-restrictions")?this.testFeature(s,o):(this._compileMe(),!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,s=>{s.type==="current-time"?this._hasDateFunctions=!0:s.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||Go.has(s.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="function"&&s.add(o.name.toLowerCase())}),Array.from(s)}getExpressions(){const s=new Map;return this._visitAll(this.parseTree,o=>{if(o.type==="function"){const f=o.name.toLowerCase(),i=o.args.value[0];if(i.type==="column-reference"){const d=i.column,m=`${f}-${d}`;s.has(m)||s.set(m,{aggregateType:f,field:d})}}}),[...s.values()]}getVariables(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="parameter"&&s.add(o.value.toLowerCase())}),Array.from(s)}_compileMe(){const s="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",s).bind(Wo)}_extractExpressionInfo(s){const o=[],f=new Set;let i=!0,d=!0;return this._visitAll(this.parseTree,m=>{switch(m.type){case"column-reference":{const t=s==null?void 0:s.get(m.column);let N,b;t?N=b=t.name??"":(b=m.column,N=b.toLowerCase()),t&&t.name&&(t.type==="date"||t.type==="esriFieldTypeDate")&&(this._datefields[t.name]=1),f.has(N)||(f.add(N),o.push(b)),m.column=b;break}case"function":{const{name:t,args:N}=m,b=N.value.length;i&&(i=Jo(t,b)),d&&(d=Ro(t,b));break}}}),{referencedFieldNames:Array.from(o),isStandardized:i,isAggregate:d}}_visitAll(s,o){if(s!=null)switch(o(s),s.type){case"when-clause":this._visitAll(s.operand,o),this._visitAll(s.value,o);break;case"case-expression":for(const f of s.clauses)this._visitAll(f,o);s.format==="simple"&&this._visitAll(s.operand,o),s.else!==null&&this._visitAll(s.else,o);break;case"expression-list":for(const f of s.value)this._visitAll(f,o);break;case"unary-expression":this._visitAll(s.expr,o);break;case"binary-expression":this._visitAll(s.left,o),this._visitAll(s.right,o);break;case"function":this._visitAll(s.args,o)}}evaluateNodeToJavaScript(s){switch(s.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(s.value)+", "+JSON.stringify(s.qualifier)+","+JSON.stringify(s.op)+")";case"case-expression":{let o="";if(s.format==="simple"){const f="this.makeComparable("+this.evaluateNodeToJavaScript(s.operand)+")";o="( ";for(let i=0;i<s.clauses.length;i++)o+=" ("+f+" === this.makeComparable("+this.evaluateNodeToJavaScript(s.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(s.clauses[i].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}else{o="( ";for(let f=0;f<s.clauses.length;f++)o+=" this.makeBool("+this.evaluateNodeToJavaScript(s.clauses[f].operand)+")===true ? ("+this.evaluateNodeToJavaScript(s.clauses[f].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}return o}case"parameter":return"this.lookup("+JSON.stringify(s.value.toLowerCase())+",lookups)";case"expression-list":{let o="[";for(const f of s.value)o!=="["&&(o+=","),o+=this.evaluateNodeToJavaScript(f);return o+="]",o}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(s.expr)+")";case"binary-expression":switch(s.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")";case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")"}throw new Error("Not Supported Operator "+s.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(s.value);case"date":return"(new Date("+Lt(s.value).getTime().toString()+"))";case"timestamp":return"(new Date("+Ee(s.value).getTime().toString()+"))";case"current-time":return s.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(s.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(s.name)+","+this.evaluateNodeToJavaScript(s.args)+")"}throw new Error("Unsupported sql syntax "+s.type)}_evaluateNode(s,o,f){switch(s.type){case"interval":{const i=this._evaluateNode(s.value,o,f);return k.createFromValueAndQualifer(i,s.qualifier,s.op)}case"case-expression":if(s.format==="simple"){const i=U(this._evaluateNode(s.operand,o,f));for(let d=0;d<s.clauses.length;d++)if(i===U(this._evaluateNode(s.clauses[d].operand,o,f)))return this._evaluateNode(s.clauses[d].value,o,f);if(s.else!==null)return this._evaluateNode(s.else,o,f)}else{for(let i=0;i<s.clauses.length;i++)if(Vt(this._evaluateNode(s.clauses[i].operand,o,f)))return this._evaluateNode(s.clauses[i].value,o,f);if(s.else!==null)return this._evaluateNode(s.else,o,f)}return null;case"parameter":return this.parameters[s.value.toLowerCase()];case"expression-list":{const i=[];for(const d of s.value)i.push(this._evaluateNode(d,o,f));return i}case"unary-expression":return fe(this._evaluateNode(s.expr,o,f));case"binary-expression":switch(s.operator){case"AND":return qt(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"OR":return Ht(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,f)===null;case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,f)!==null;case"IN":{const i=Ce(this._evaluateNode(s.right,o,f));return Fe(this._evaluateNode(s.left,o,f),i)}case"NOT IN":{const i=Ce(this._evaluateNode(s.right,o,f));return fe(Fe(this._evaluateNode(s.left,o,f),i))}case"BETWEEN":{const i=this._evaluateNode(s.left,o,f),d=this._evaluateNode(s.right,o,f);return i==null||d[0]==null||d[1]==null?null:i>=U(d[0])&&i<=U(d[1])}case"NOTBETWEEN":{const i=this._evaluateNode(s.left,o,f),d=this._evaluateNode(s.right,o,f);return i==null||d[0]==null||d[1]==null?null:i<U(d[0])||i>U(d[1])}case"LIKE":return Pe(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f),s.escape);case"NOT LIKE":return fe(Pe(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f),s.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Bt(s.operator,this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"-":case"+":case"*":case"/":case"||":return jt(s.operator,this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f))}case"null":case"boolean":case"string":case"number":return s.value;case"date":return Lt(s.value);case"timestamp":return Ee(s.value);case"current-time":{const i=new Date;return s.mode==="date"&&i.setHours(0,0,0,0),i}case"column-reference":return zt(o,s.column,this._datefields,f);case"data-type":return s.value;case"function":{const i=this._evaluateNode(s.args,o,f);return this.isAggregate?Mo(s.name,i):_e(s.name,i)}}throw new Error("Unsupported sql syntax "+s.type)}}function Ee(l){let s=Ho.exec(l);if(s!==null){const[,o,f,i,d,m,t]=s;return Z(o,f,i,d,m,t)}if(s=Bo.exec(l),s!==null){const[,o,f,i,d,m,t,N,b,_]=s;return Z(o,f,i,d,m,t,N,b,_)}if(s=jo.exec(l),s!==null){const[,o,f,i,d,m,t,N,b]=s;return Z(o,f,i,d,m,"0",t,N,b)}if(s=zo.exec(l),s!==null){const[,o,f,i,d,m]=s;return Z(o,f,i,d,m)}if(s=kt.exec(l),s!==null){const[,o,f,i]=s;return Z(o,f,i)}throw new Error("SQL Invalid Timestamp")}function Lt(l){const s=kt.exec(l);if(s===null)try{return Ee(l)}catch{throw new Error("SQL Invalid Date")}const[,o,f,i]=s;return new Date(parseInt(o,10),parseInt(f,10)-1,parseInt(i,10))}function Vt(l){return l===!0}function Ce(l){return Array.isArray(l)?l:[l]}function fe(l){return l!==null?l!==!0:null}function qt(l,s){return l!=null&&s!=null?l===!0&&s===!0:l!==!1&&s!==!1&&null}function Ht(l,s){return l!=null&&s!=null?l===!0||s===!0:l===!0||s===!0||null}function Fe(l,s){if(l==null)return null;let o=!1;for(const f of s)if(f==null)o=null;else if(l===f){o=!0;break}return o}const Mt="-[]/{}()*+?.\\^$|";var G;function Yo(l,s){const o=s;let f="",i=G.Normal;for(let d=0;d<l.length;d++){const m=l.charAt(d);switch(i){case G.Normal:m===o?i=G.Escaped:Mt.includes(m)?f+="\\"+m:f+=m==="%"?".*":m==="_"?".":m;break;case G.Escaped:Mt.includes(m)?f+="\\"+m:f+=m,i=G.Normal}}return new RegExp("^"+f+"$","m")}function Pe(l,s,o){return l==null?null:Yo(s,o).test(l)}function U(l){return l instanceof Date?l.valueOf():l}function Bt(l,s,o){if(s==null||o==null)return null;const f=U(s),i=U(o);switch(l){case"<>":return f!==i;case"=":return f===i;case">":return f>i;case"<":return f<i;case">=":return f>=i;case"<=":return f<=i}}function jt(l,s,o){if(l==="||")return _e("concat",[s,o]);if(s instanceof k)if(o instanceof Date)switch(l){case"+":return new Date(s.valueInMilliseconds()+o.getTime());case"-":return s.valueInMilliseconds()-o.getTime();case"*":return s.valueInMilliseconds()*o.getTime();case"/":return s.valueInMilliseconds()/o.getTime()}else if(o instanceof k)switch(l){case"+":return k.createFromMilliseconds(s.valueInMilliseconds()+o.valueInMilliseconds());case"-":return k.createFromMilliseconds(s.valueInMilliseconds()-o.valueInMilliseconds());case"*":return s.valueInMilliseconds()*o.valueInMilliseconds();case"/":return s.valueInMilliseconds()/o.valueInMilliseconds()}else s=s.valueInMilliseconds();else if(o instanceof k)if(s instanceof Date)switch(l){case"+":return new Date(o.valueInMilliseconds()+s.getTime());case"-":return new Date(s.getTime()-o.valueInMilliseconds());case"*":return s.getTime()*o.valueInMilliseconds();case"/":return s.getTime()/o.valueInMilliseconds()}else o=o.valueInMilliseconds();else if(s instanceof Date&&typeof o=="number")switch(o=24*o*60*60*1e3,s=s.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}else if(o instanceof Date&&typeof s=="number")switch(s=24*s*60*60*1e3,o=o.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}switch(l){case"+":return s+o;case"-":return s-o;case"*":return s*o;case"/":return s/o}}function Ko(l){return l&&typeof l.attributes=="object"}function zt(l,s,o,f){const i=f.getAttribute(l,s);return i!=null&&o[s]===1?new Date(i):i}(function(l){l[l.Normal=0]="Normal",l[l.Escaped=1]="Escaped"})(G||(G={}));const z={getAttribute:(l,s)=>(Ko(l)?l.attributes:l)[s]},ti=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:Le,defaultAttributeAdapter:z},Symbol.toStringTag,{value:"Module"}));export{ti as W,Le as f,M as n,Xo as o,j as s,C as t};
