import{b as P,ds as M,dt as $,aA as A,aB as C}from"./index-Cy4mlNgs.js";const J={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(t){return J[t]}function*k(t){switch(t.type){case"Feature":yield t;break;case"FeatureCollection":for(const e of t.features)e&&(yield e)}}function*v(t){if(t)switch(t.type){case"Point":yield t.coordinates;break;case"LineString":case"MultiPoint":yield*t.coordinates;break;case"MultiLineString":case"Polygon":for(const e of t.coordinates)yield*e;break;case"MultiPolygon":for(const e of t.coordinates)for(const n of e)yield*n}}function*x(t,e={}){const{geometryType:n,objectIdField:o}=e;for(const r of t){const{geometry:s,properties:d,id:i}=r;if(s&&b(s.type)!==n)continue;const l=d||{};let c;o&&(c=l[o],i==null||c||(l[o]=c=i)),yield new A(s?Z(new C,s,e):null,l,null,c??void 0)}}function D(t){for(const e of t)if(e.length>2)return!0;return!1}function E(t){return!T(t)}function R(t){return T(t)}function T(t){let e=0;for(let n=0;n<t.length;n++){const o=t[n],r=t[(n+1)%t.length];e+=o[0]*r[1]-r[0]*o[1]}return e<=0}function L(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]||t.push(e),t}function Z(t,e,n){switch(e.type){case"LineString":return B(t,e,n);case"MultiLineString":return H(t,e,n);case"MultiPoint":return q(t,e,n);case"MultiPolygon":return z(t,e,n);case"Point":return K(t,e,n);case"Polygon":return Q(t,e,n)}}function B(t,e,n){return g(t,e.coordinates,n),t}function H(t,e,n){for(const o of e.coordinates)g(t,o,n);return t}function q(t,e,n){return g(t,e.coordinates,n),t}function z(t,e,n){for(const o of e.coordinates){O(t,o[0],n);for(let r=1;r<o.length;r++)I(t,o[r],n)}return t}function K(t,e,n){return S(t,e.coordinates,n),t}function Q(t,e,n){const o=e.coordinates;O(t,o[0],n);for(let r=1;r<o.length;r++)I(t,o[r],n);return t}function O(t,e,n){const o=L(e);E(o)?N(t,o,n):g(t,o,n)}function I(t,e,n){const o=L(e);R(o)?N(t,o,n):g(t,o,n)}function g(t,e,n){for(const o of e)S(t,o,n);t.lengths.push(e.length)}function N(t,e,n){for(let o=e.length-1;o>=0;o--)S(t,e[o],n);t.lengths.push(e.length)}function S(t,e,n){const[o,r,s]=e;t.coords.push(o,r),n.hasZ&&t.coords.push(s||0)}function U(t){switch(typeof t){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function W(t){if(!t)throw new P("geojson-layer:empty","GeoJSON data is empty");if(t.type!=="Feature"&&t.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:e}=t;if(!e)return;const n=typeof e=="string"?e:e.type==="name"?e.properties.name:e.type==="EPSG"?e.properties.code:null,o=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!o.test(n))throw new P("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:e})}function X(t,e={}){const n=[],o=new Set,r=new Set;let s,d=!1,i=null,l=!1,{geometryType:c=null}=e,m=!1;for(const p of k(t)){const{geometry:h,properties:u,id:a}=p;if((!h||(c||(c=b(h.type)),b(h.type)===c))&&(d||(d=D(v(h))),l||(l=a!=null,l&&(s=typeof a,u&&(i=Object.keys(u).filter(y=>u[y]===a)))),u&&i&&l&&a!=null&&(i.length>1?i=i.filter(y=>u[y]===a):i.length===1&&(i=u[i[0]]===a?i:[])),!m&&u)){let y=!0;for(const f in u){if(o.has(f))continue;const F=u[f];if(F==null){y=!1,r.add(f);continue}const j=U(F);if(j==="unknown"){r.add(f);continue}r.delete(f),o.add(f);const G=M(f);G&&n.push({name:G,alias:f,type:j})}m=y}}const w=M((i==null?void 0:i.length)===1&&i[0]||null)??void 0;if(w){for(const p of n)if(p.name===w&&$(p)){p.type="esriFieldTypeOID";break}}return{fields:n,geometryType:c,hasZ:d,objectIdFieldName:w,objectIdFieldType:s,unknownFields:Array.from(r)}}function Y(t,e){return Array.from(x(k(t),e))}export{Y as I,X as L,W as T,b as s};
