import{bc as it,bd as rt,iW as nt,e as W,y as G,iX as q,be as ot,em as Ie,aP as Re,gx as Pe,a as at,at as b,aV as lt,mS as ie,ue as ct,uf as dt,O as Se,uh as Ne,vk as Ue,ul as ut,uT as gt,iQ as re,up as ht,uq as pt,ur as ft,us as bt,ux as mt,h$ as _t,vl as $t,rw as Q,uE as Tt,_ as Ot,uG as wt,vL as Ct,uI as At,uJ as vt,hX as Et,hY as It,iP as _,vm as Rt,iR as Le,fk as Pt,lg as De,i4 as Xe,k0 as St,ld as L,iJ as l,cm as Nt,mY as Me,vM as qe,vN as me,lk as Ut,fI as p,nc as Lt,a0 as Mt,vO as yt,om as de,vJ as Ye,iU as Y,qs as R,bf as N,iT as Vt,eY as U,lc as ze,rR as we,lo as Z,rW as Ze,gb as z,$ as ne,fJ as f,gd as Je,iG as O,W as oe,Z as M,iS as K,lQ as ee,qt as ye,rV as Ve,bn as fe,eX as ke,mZ as We,vP as xe,rU as Ge,s3 as kt,l6 as Wt,lf as H,lm as xt,s8 as Gt,vQ as _e,vR as Ht,vS as Bt,bk as jt,Y as P,ca as Ft}from"./index-ZXy_8vtR.js";import{i as B,u as Qe}from"./analysisThemeUtils-CLpkxpqP.js";import{b as Dt,u as Xt,r as qt}from"./LineVisualElement-BRgvk9Ff.js";import{N as Yt,$ as Ke,e as A,U as zt,R as Zt}from"./ShadedColorMaterial.glsl-BaKRHFxj.js";let w=class extends it(rt){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&nt(this.position,t.position)&&this.width===t.width&&this.height===t.height}};W([G({readOnly:!0,json:{read:!1,write:!0}})],w.prototype,"type",void 0),W([G({type:ot}),q()],w.prototype,"position",void 0),W([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),q(),Ie(e=>Re.normalize(Pe(e),0,!0))],w.prototype,"heading",void 0),W([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),q(),Ie(e=>Re.normalize(Pe(e),0,!0))],w.prototype,"tilt",void 0),W([G({type:Number,nonNullable:!0}),q()],w.prototype,"width",void 0),W([G({type:Number,nonNullable:!0}),q()],w.prototype,"height",void 0),w=W([at("esri.analysis.SlicePlane")],w);const Jt=w;let Qt=class{constructor(){this.color=B()}},Kt=class{constructor(){this.color=new b([0,0,0,.04]),this.gridColor=B(.5),this.outlineColor=B(.7)}},es=class{constructor(){this.color=B()}},ts=class{constructor(){this.color=B(.5),this.contrastColor=Qe()}},ss=class{constructor(){this.color=Qe(),this.outlineColor=B()}},is=class{constructor(){this.callouts=new Qt,this.plane=new Kt,this.resizeManipulators=new es,this.rotateManipulators=new ts,this.shiftManipulator=new ss}},ae=new is;const js=lt("mac")?"Meta":"Control",Fs="Shift",rs=2,ns=1.15,os=1.15,Ds=2500,Xs=.02,as=Math.cos(ie(45)),He=Math.cos(ie(5)),qs=.95,Ys=.3,zs=2,ls=1,cs=3,et=11,$e=22.5,se=40,ds=48,us=2.25,gs=4,Be=1,hs=.3,ps=6,fs=4,je=1600,bs=.4;function tt(e){const t=new ct,{vertex:i,fragment:s,attributes:n,varyings:o}=t;return dt(i,e),n.add(Se.POSITION,"vec3"),n.add(Se.UV0,"vec2"),o.add("vUV","vec2"),i.code.add(Ne`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),s.uniforms.add(new Ue("backgroundColor",r=>r.backgroundColor),new Ue("gridColor",r=>r.gridColor),new ut("gridWidth",r=>r.gridWidth)),s.code.add(Ne`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const ms=Object.freeze(Object.defineProperty({__proto__:null,build:tt},Symbol.toStringTag,{value:"Module"}));class _s extends gt{constructor(){super(...arguments),this.backgroundColor=re(1,0,0,.5),this.gridColor=re(0,1,0,.5),this.gridWidth=4}}class ue extends ht{initializeProgram(t){return new pt(t.rctx,ue.shader.get().build(this.configuration),ft)}initializePipeline(){return bt({blending:$t(Q.ONE,Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ONE_MINUS_SRC_ALPHA),depthTest:{func:_t.LESS},colorWrite:mt})}}ue.shader=new Tt(ms,()=>Ot(()=>Promise.resolve().then(()=>Ns),void 0));class $s extends wt{constructor(t){super(t,new Os),this._configuration=new Ct}createBufferWriter(){return new At(vt)}requiresSlot(t,i){return i===Et.Color&&t===It.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new Ts(t)}getConfiguration(){return this._configuration}}class Ts extends Rt{constructor(t){super(t),this.ensureTechnique(ue,null)}beginSlot(){return this.technique}}class Os extends _s{constructor(){super(...arguments),this.renderOccluded=_.Occlude}}class ws extends Dt{constructor(t){super(t),this._material=null,this._renderOccluded=_.OccludeAndTransparent,this._gridWidth=1,this._gridColor=re(1,0,0,1),this._backgroundColor=re(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Le(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Le(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new $s(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const i=Pt(this._material);t.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Zs(e,t,i,s,n,o,r,a){return Cs(t,r.worldUpAtPosition(e,l.get()),n,o,a.basis1,a.basis2),p(a.basis1,a.basis1,i),p(a.basis2,a.basis2,s),U(a.origin,e),qe(a.basis2,a.basis1,a.origin,a.plane),a}function Cs(e,t,i,s,n,o){const r=H(e,t),a=l.get(),d=l.get();switch(s===S.HORIZONTAL_OR_VERTICAL?Math.abs(r)>as?S.HORIZONTAL:S.VERTICAL:s){case S.VERTICAL:{const h=Math.abs(r)<=He?e:i.viewUp;P(a,h,t),U(d,t);break}case S.HORIZONTAL:P(a,i.viewUp,t),P(d,t,a);break;case S.TILTED:{const h=Math.abs(r)<=He?t:i.viewUp;P(a,h,e),P(d,e,a);break}}const g=P(l.get(),a,d);H(g,i.viewForward)>0&&p(d,d,-1),M(n,a),M(o,d)}function As(e,t,i){const s=t.worldUpAtPosition(e.origin,l.get()),n=e.basis1,o=ve(e,s),r=Math.round(o/j)*j;return me(e,r-o,n,i)}function Js(e,t,i,s,n,o){const r=U(l.get(),n.origin);f(r,r,p(l.get(),n.basis1,e.direction[0]<0?1:-1)),f(r,r,p(l.get(),n.basis2,e.direction[1]<0?1:-1));const a=L(n.basis1),d=L(n.basis2),g=O(l.get(),i,r),h=O(l.get(),t,r);let u=0,c=0;if(Ae(e)){const T=Te(n),ge=Te(o);u=a-.5*e.direction[0]*H(n.basis1,h)/a,c=d-.5*e.direction[1]*H(n.basis2,h)/d;const F=ge/T;u*=F,c*=F}const $=u+.5*e.direction[0]*H(n.basis1,g)/a,m=c+.5*e.direction[1]*H(n.basis2,g)/d,y=p(l.get(),n.basis1,$/a),E=p(l.get(),n.basis2,m/d);($<=0||Fe(o.origin,y,s)<=je)&&U(y,o.basis1),(m<=0||Fe(o.origin,E,s)<=je)&&U(E,o.basis2);const I=U(l.get(),r);return f(I,I,p(l.get(),y,e.direction[0]<0?-1:1)),f(I,I,p(l.get(),E,e.direction[1]<0?-1:1)),xt(I,y,E,o)}function Qs(e,t){return bs*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Ks(e,t,i,s){const n=P(l.get(),t,i);return P(n,n,t),ze(e,n,s)}function ei(e,t){return Yt(e.basis1,e.basis2,e.origin,t)}function ti(e,t,i,s){const n=t.worldUpAtPosition(e.origin,l.get()),o=l.get();switch(i){case le.HEADING:U(o,n);break;case le.TILT:U(o,e.basis1)}return ze(e.origin,o,s)}function si(e,t,i,s){const n=Ce(i,v.NEGATIVE_X),o=Z.get();Gt(o,t,n.edge*Math.PI/2);const r=M(l.get(),n.basis);let a=p(l.get(),r,n.direction*s.computeScreenPixelSizeAt(n.position)*se);f(a,a,n.position);const d=s.projectToRenderScreen(a,_e(l.get())),g=vs(s,d);Ht(s,d,te),M(te.direction,te.direction);const h=l.get();!g&&Bt(i,te,h)&&(a=h),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=jt(a),g?e.state|=ce:e.state&=~ce}function vs(e,t){const[i,s,n,o]=e.viewport,r=Math.min(n,o)/16;let a=!0;return t[0]<i+r?(t[0]=i+r,a=!1):t[0]>i+n-r&&(t[0]=i+n-r,a=!1),t[1]<s+r?(t[1]=s+r,a=!1):t[1]>s+o-r&&(t[1]=s+o-r,a=!1),a}function ii(e,t,i,s){const n=L(s.basis1),o=L(s.basis2),r=st(s),a=Te(s),d=ne(l.get(),0,0,0);f(d,p(l.get(),s.basis1,t.direction[0]),p(l.get(),s.basis2,t.direction[1])),f(d,s.origin,d);let g=0,h=1;if(Ae(t))t.direction[0]===1&&t.direction[1]===-1?g=j:t.direction[0]===1&&t.direction[1]===1?g=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(g=3*Math.PI/2),h=a;else{const c=t.direction[0]!==0?1:2;g=c===1?j:0,h=(c===1?o:n)-r}const u=we(Z.get(),g);Je(u,u,ne(l.get(),h,h,h)),z(u,i,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=d}function ri(e,t,i,s){const n=s.worldUpAtPosition(i.origin,l.get()),o=Ce(i,v.POSITIVE_X),r=we(Z.get(),o.edge*Math.PI/2);Ze(r,r,-ve(i,n)),z(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=o.position}function ni(e,t,i){const s=Ce(i,v.POSITIVE_Y),n=we(Z.get(),s.edge*Math.PI/2);Ze(n,n,j),z(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=s.position}var v;function Ce(e,t){switch(t){case v.POSITIVE_X:return{basis:e.basis1,direction:1,position:f(l.get(),e.origin,e.basis1),edge:t};case v.POSITIVE_Y:return{basis:e.basis2,direction:1,position:f(l.get(),e.origin,e.basis2),edge:t};case v.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:O(l.get(),e.origin,e.basis1),edge:t};case v.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:O(l.get(),e.origin,e.basis2),edge:t}}}function Fe(e,t,i){const s=i.projectToRenderScreen(f(l.get(),e,t),_e(l.get())),n=i.projectToRenderScreen(O(l.get(),e,t),_e(l.get()));return Ft(O(s,s,n))}function st(e){const t=L(e.basis1),i=L(e.basis2);return hs*Math.min(t,i)}function Te(e){return st(e)}function Ae(e){return e.direction[0]!==0&&e.direction[1]!==0}function oi(e,t){const i=t.offsetMode===Oe.CENTER_ON_CALLOUT?se:0,s=[N(i,0,-48/2),N(i,0,ds/2)],n=Rs(s,!0),o=(u,c)=>Es(s,u,c,t),r=o(0,!1),a=o(us,!0),d=new Ye({color:b.toUnitRGBA(t.calloutColor),renderOccluded:_.OccludeAndTransparent}),g=Y(d,[[i,0,0],[i-se,0,0]]),h=Y(d,[[i,0,0],[i-se,0,0]]);return new Ke({view:e,renderObjects:[...r.normal.map(u=>new A(u,R.Unfocused|C)),...a.normal.map(u=>new A(u,R.Unfocused|C)),new A(g,R.Unfocused|C|ce),...r.focused.map(u=>new A(u,R.Focused|C)),...a.focused.map(u=>new A(u,R.Focused|C)),new A(h,R.Focused|C|ce)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:et,state:C})}function ai(e,t){const i=Zt(e,{calloutColor:b.toUnitRGBA(ae.callouts.color),customStateMask:C,texture:t});return i.state=C,i}function li(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Xt({view:e,attached:!1,color:b.toUnitRGBA(ae.plane.outlineColor),width:ls,renderOccluded:_.OccludeAndTransparent,geometry:[t]})}function ci(e){return new ws({view:e,attached:!1,backgroundColor:b.toUnitRGBA(ae.plane.color),gridColor:b.toUnitRGBA(ae.plane.gridColor),gridWidth:4,renderOccluded:_.OccludeAndTransparent})}function di(e,t,i){const s=Ae(t),n=s?[N(1,0,0),N(0,0,0),N(0,1,0)]:[N(1,0,0),N(-1,0,0)],o=b.toUnitRGBA(i.color),r=m=>new Vt({color:o,width:m,renderOccluded:_.OccludeAndTransparent}),a=()=>new Ye({color:o,renderOccluded:_.OccludeAndTransparent}),d=s?gs:Be,g=d*rs,h=Be,u=m=>m>1?r(m):a(),c=[new A(Y(u(d),n),R.Unfocused|be),new A(Y(u(g),n),R.Focused|be),new A(Y(u(h),n),Ss)],$=new Ke({view:e,renderObjects:c,collisionType:{type:"line",paths:[n]},radius:s?ps:fs,...zt});return $.state=be,$}function Es(e,t,i,s){const n=b.blendColors(s.color,s.outlineColor,.4),o=b.blendColors(s.color,s.outlineColor,.14),r=new K({color:b.toUnitRGBA(s.color),cullFace:ee.Back,renderOccluded:_.Opaque}),a=new K({color:b.toUnitRGBA(n),cullFace:ee.Back,renderOccluded:_.Opaque}),d=new K({color:b.toUnitRGBA(o),cullFace:ee.Back,renderOccluded:_.Opaque}),g=new K({color:b.toUnitRGBA(s.outlineColor),transparent:!0,writeDepth:!1,cullFace:ee.Front,renderOccluded:_.Transparent}),h=u=>{const c=e.slice(0),$=O(l.get(),c[0],c[1]);M($,$);const m=O(l.get(),c[c.length-1],c[c.length-2]);if(M(m,m),t>0){const X=p(oe(),m,-t);c[c.length-1]=f(X,X,c[c.length-1]);const x=p(oe(),$,-t);c[0]=f(x,x,c[0])}const y=u?os:1,E=$e*y,I=et*y,T=ye(Z.get());if(t>0){const X=E/4,x=ne(l.get(),0,X,0),J=1+t/X;Ve(T,T,x),Je(T,T,ne(l.get(),J,J,J)),Ve(T,T,p(x,x,-1/J))}const ge=ye(fe()),F=N(0,1,0),V=ke(fe(),We(xe.get(),F,m));V[12]=c[c.length-1][0],V[13]=c[c.length-1][1],V[14]=c[c.length-1][2],z(V,V,T);const Ee=Is(cs*(u?ns:1)+t,c,i?g:d);Ee.transformation=ge;const D=[Ee],he=Ge(i?g:r,E,I,24,!1,!1,!0);he.transformation=V,D.push(he);const pe=Ge(i?g:a,E,I,24,!1,!0,!1);pe.transformation=V,D.push(pe);const k=ke(fe(),We(xe.get(),F,$));return k[12]=c[0][0],k[13]=c[0][1],k[14]=c[0][2],z(k,k,T),D.push(he.instantiate({transformation:k})),D.push(pe.instantiate({transformation:k})),D};return{normal:h(!1),focused:h(!0)}}function Is(e,t,i){const s=[];for(let o=0;o<12;o++){const r=o/12*2*Math.PI;s.push([Math.cos(r)*e,Math.sin(r)*e])}return kt(i,s,t,[],[],!1)}function Rs(e,t){const i=O(oe(),e[e.length-1],e[e.length-2]);if(M(i,i),p(i,i,$e),f(i,i,e[e.length-1]),t){const s=O(oe(),e[0],e[1]);return M(s,s),p(s,s,$e),f(s,s,e[0]),[s,...e,i]}}function ui(e,t,i,s=new Jt){if(e==null)return null;const{renderCoordsHelper:n}=t,o=n.fromRenderCoords(e.origin,t.spatialReference);if(o==null)return null;const r=St(o,i);if(r==null)return null;s.position=r;const a=2*L(e.basis1),d=2*L(e.basis2),g=Xe.renderUnitScaleFactor(t.spatialReference,i);s.width=a*g,s.height=d*g;const h=n.worldUpAtPosition(e.origin,l.get());return s.tilt=Nt(ve(e,h)),s.heading=n.headingAtPosition(e.origin,e.basis1)-90,s}function ve(e,t){return yt(t,e.basis2,e.basis1)+j}function Ps(e,t,i,s,n,o,r=De()){return o.toRenderCoords(e,r.origin)?(o.worldBasisAtPosition(r.origin,Me.X,r.basis1),o.worldBasisAtPosition(r.origin,Me.Y,r.basis2),qe(r.basis2,r.basis1,r.origin,r.plane),me(r,-ie(t),Ut(r),r),me(r,ie(i),r.basis1,r),p(r.basis1,r.basis1,s/2),p(r.basis2,r.basis2,n/2),Lt(r),r):(Mt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function gi(e,t){if(e==null||e.position==null)return null;const i=qt(e.position,t.spatialReference,t.elevationProvider);if(i==null)return null;const s=Xe.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),n=e.width*s,o=e.height*s;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:n,renderHeight:o}}function hi(e,t,i,s=De()){if(e==null)return null;const n=Ps(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,s);return i.tiltEnabled||n==null||As(n,t.renderCoordsHelper,n),n}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(v||(v={}));const C=de.Custom1;var le,S;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(le||(le={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(S||(S={}));const ce=de.Custom2,te=Wt(),j=Math.PI/2,be=de.Custom1,Ss=de.Custom2;var Oe;function pi(e){return(e.type==="building-scene-3d"?e:null)!=null}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(Oe||(Oe={}));const Ns=Object.freeze(Object.defineProperty({__proto__:null,build:tt},Symbol.toStringTag,{value:"Module"}));export{Ae as $,pi as A,si as B,ni as D,ii as F,Ks as G,ti as H,oi as J,ai as K,zs as M,Oe as O,li as Q,Qs as S,be as T,ri as X,ae as a,Fs as b,js as c,hi as d,di as e,Ys as f,S as g,Jt as h,C as i,qs as j,ei as k,gi as l,Ds as m,Xs as n,ls as o,le as p,ce as q,ui as r,ci as t,Zs as v,Ss as w,Js as y,Te as z};
