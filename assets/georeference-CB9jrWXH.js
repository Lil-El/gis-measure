import{a0 as B,g4 as h,g5 as N,g6 as W,g7 as m,bf as q,g8 as x,fm as F,g9 as D,ga as E,cr as J,dD as $,ce as b,C as L,fv as d,bn as S,gb as k,gc as O,bs as H,gd as I,ge as K,gf as y,gg as Q,gh as X,gi as Y,aJ as Z,gj as U,gk as V,gl as nn,fP as en}from"./index-BZRBOKU4.js";import{m as tn}from"./MeshGeoreferencedRelativeVertexSpace-C_5MqZlG.js";import{m as rn,p as on}from"./MeshLocalVertexSpace-BznxjFta.js";import{N as an}from"./MeshTransform-Danlj2Gi.js";function T(n,t){return n.isGeographic||n.isWebMercator&&((t==null?void 0:t.geographic)??!0)}function bn(n,t,e){const r=!n.isGeoreferenced;(e==null?void 0:e.geographic)!=null&&e.geographic!==r&&B.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}function A(n,t,e){return T(t.spatialReference,e)?un(n,t,e):gn(n,t,e)}function j(n,t,e,r){const{position:a,normal:o,tangent:i}=n;if(!t.isRelative)return{position:a,normal:o,tangent:i};const l=(e==null?void 0:e.localMatrix)??h;return A({position:m(new Float64Array(a.length),a,l),normal:o!=null?W(o,new Float32Array(o.length),l):null,tangent:i!=null?N(i,new Float32Array(i.length),l):null},t.getOriginPoint(r),{geographic:!t.isGeoreferenced})}function sn(n,t,e){if(e!=null&&e.useTransform){const{position:r,normal:a,tangent:o}=n,{x:i,y:l,z:c}=t,s=q(i,l,c??0);return{vertexAttributes:{position:r,normal:a,tangent:o},vertexSpace:e.geographic??1?new rn({origin:s}):new tn({origin:s}),transform:new an}}return{vertexAttributes:A(n,t,e),vertexSpace:new on,transform:null}}function w(n,t,e){return T(t.spatialReference,e)?hn(n,t,e):z(n,t,e)}function ln(n,t,e,r,a){if(!t.isRelative)return w(n,r,a);const{spatialReference:o}=r,i=j(n,t,e,o);return r.equals(t.getOriginPoint(o))?z(i,r,a):w(i,r,a)}function cn({positions:n,transform:t,vertexSpace:e,inSpatialReference:r,outSpatialReference:a,outPositions:o,local:i}){const l=e.isRelative?e.origin:x,c=e.isRelative?(t==null?void 0:t.localMatrix)??h:h;if(e.isGeoreferenced){const g=o??F(n.length);if(D(c,h)?E(g,n):m(g,n,c),!J(l,x)){const[P,C,G]=l;for(let p=0;p<g.length;p+=3)g[p]+=P,g[p+1]+=C,g[p+2]+=G}return $(g,r,0,g,a,0,g.length/3),g}const s=b(r),v=!i&&L(r,s)?s:r;d(r,l,u,v),k(u,u,c);const f=o??F(n.length);return m(f,n,u),$(f,v,0,f,a,0,f.length/3),f}function gn(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=a[s]*c+o,r[s+1]=a[s+1]*c+i,r[s+2]=a[s+2]*c+l;return{position:r,normal:n.normal,tangent:n.tangent}}function un(n,t,e){const r=t.spatialReference,a=M(t,e,u),o=new Float64Array(n.position.length),i=fn(n.position,a,r,o),l=O(_,a);return{position:i,normal:pn(i,o,n.normal,l,r),tangent:mn(i,o,n.tangent,l,r)}}function fn(n,t,e,r){m(r,n,t);const a=new Float64Array(n.length);return K(r,a,e)}function pn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);return y(o,e,r),X(o,n,t,a,o),o}function mn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);y(o,e,r,4);for(let i=3;i<o.length;i+=4)o[i]=e[i];return Q(o,n,t,a,o),o}function z(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=(a[s]-o)/c,r[s+1]=(a[s+1]-i)/c,r[s+2]=(a[s+2]-l)/c;return{position:r,normal:n.normal,tangent:n.tangent}}function hn(n,t,e){const r=t.spatialReference;M(t,e,u);const a=H(Rn,u),o=new Float64Array(n.position.length),i=yn(n.position,r,a,o),l=O(_,a);return{position:i,normal:wn(n.normal,n.position,o,r,l),tangent:An(n.tangent,n.position,o,r,l)}}function M(n,t,e){d(n.spatialReference,[n.x,n.y,n.z??0],e,b(n.spatialReference));const r=R(t?t.unit:null,n.spatialReference);return I(e,e,[r,r,r]),e}function yn(n,t,e,r){const a=U(n,t,r),o=new Float64Array(a.length);return m(o,a,e),o}function wn(n,t,e,r,a){if(n==null)return null;const o=nn(n,t,e,r,new Float32Array(n.length));return y(o,o,a),o}function An(n,t,e,r,a){if(n==null)return null;const o=V(n,t,e,r,new Float32Array(n.length));return y(o,o,a,4),o}function R(n,t){if(n==null)return 1;const e=Y(t);return 1/Z(e,"meters",n)}const u=S(),Rn=S(),_=en(),dn=Object.freeze(Object.defineProperty({__proto__:null,georeference:A,georeferenceApplyTransform:j,georeferenceByTransform:sn,project:cn,ungeoreference:w,ungeoreferenceByTransform:ln},Symbol.toStringTag,{value:"Module"}));export{w as D,ln as E,cn as I,A as O,j as T,dn as g,bn as o,sn as q,T as r};
